#!/bin/sh

#-----------------Calculation-----------------------
for ecutwfc in 50;
do

for ecutrho in 400;
do

for k in 2;
do

for mag in 0.01;
do

condition_name=ecutwfc_${ecutwfc}_ecutrho_${ecutrho}_kpoint_${k}_mag_${mag}

prefix=RbBr222_${condition_name}

cat << EOF > ${prefix}.alm.in
&general
  PREFIX = ${prefix}
  MODE = suggest
  NAT = 64
  NKD = 2
  KD = Br Rb 
/

&interaction
  NORDER = 1
/

&cell
  1.8897261246257702
  14.036 0.0 0.0
  0.0 14.036 0.0
  0.0 0.0 14.036
/

&cutoff
  *-* None
/

&position
  2 0.0 0.0 0.0
  1 0.0 0.25 0.0
  2 0.0 0.25 0.25
  1 0.0 0.0 0.25
  2 0.25 0.0 0.25
  1 0.25 0.25 0.25
  2 0.25 0.25 0.0
  1 0.25 0.0 0.0
  2 0.0 0.0 0.5
  1 0.0 0.25 0.5
  2 0.0 0.25 0.75
  1 0.0 0.0 0.75
  2 0.25 0.0 0.75
  1 0.25 0.25 0.75
  2 0.25 0.25 0.5
  1 0.25 0.0 0.5
  2 0.0 0.5 0.0
  1 0.0 0.75 0.0
  2 0.0 0.75 0.25
  1 0.0 0.5 0.25
  2 0.25 0.5 0.25
  1 0.25 0.75 0.25
  2 0.25 0.75 0.0
  1 0.25 0.5 0.0
  2 0.0 0.5 0.5
  1 0.0 0.75 0.5
  2 0.0 0.75 0.75
  1 0.0 0.5 0.75
  2 0.25 0.5 0.75
  1 0.25 0.75 0.75
  2 0.25 0.75 0.5
  1 0.25 0.5 0.5
  2 0.5 0.0 0.0
  1 0.5 0.25 0.0
  2 0.5 0.25 0.25
  1 0.5 0.0 0.25
  2 0.75 0.0 0.25
  1 0.75 0.25 0.25
  2 0.75 0.25 0.0
  1 0.75 0.0 0.0
  2 0.5 0.0 0.5
  1 0.5 0.25 0.5
  2 0.5 0.25 0.75
  1 0.5 0.0 0.75
  2 0.75 0.0 0.75
  1 0.75 0.25 0.75
  2 0.75 0.25 0.5
  1 0.75 0.0 0.5
  2 0.5 0.5 0.0
  1 0.5 0.75 0.0
  2 0.5 0.75 0.25
  1 0.5 0.5 0.25
  2 0.75 0.5 0.25
  1 0.75 0.75 0.25
  2 0.75 0.75 0.0
  1 0.75 0.5 0.0
  2 0.5 0.5 0.5
  1 0.5 0.75 0.5
  2 0.5 0.75 0.75
  1 0.5 0.5 0.75
  2 0.75 0.5 0.75
  1 0.75 0.75 0.75
  2 0.75 0.75 0.5
  1 0.75 0.5 0.5
/

EOF

alm ${prefix}.alm.in > ${prefix}.alm.log0 2> ${prefix}.alm.err

cat << EOF > pw.scf_${condition_name}.in
&CONTROL
   calculation      = 'scf'
   tstress          = .true.
   tprnfor          = .true.
   outdir           = 'RbBr'
   prefix           = 'RbBr'
   pseudo_dir       = '/home/tomuhama/rbbr/harmonic/'
/
&SYSTEM
   ecutwfc          = ${ecutwfc}
   ecutrho          = ${ecutrho}
   occupations      = 'fixed'
   ntyp             = 2
   nat              = 64
   ibrav            = 0
/
&ELECTRONS
   electron_maxstep = 300
   conv_thr         = 1e-10
/
&IONS
/
&CELL
/

ATOMIC_SPECIES
Rb 85.4678 Rb.pbe-spn-kjpaw_psl.1.0.0.UPF
Br 79.904 Br.pbe-n-kjpaw_psl.1.0.0.UPF

K_POINTS automatic
${k} ${k} ${k} 0 0 0

CELL_PARAMETERS angstrom
14.03600000000000 0.00000000000000 0.00000000000000
0.00000000000000 14.03600000000000 0.00000000000000
0.00000000000000 0.00000000000000 14.03600000000000

ATOMIC_POSITIONS angstrom
Rb 0.0000000000 0.0000000000 0.0000000000 
Br 0.0000000000 3.5090000000 0.0000000000 
Rb 0.0000000000 3.5090000000 3.5090000000 
Br 0.0000000000 0.0000000000 3.5090000000 
Rb 3.5090000000 0.0000000000 3.5090000000 
Br 3.5090000000 3.5090000000 3.5090000000 
Rb 3.5090000000 3.5090000000 0.0000000000 
Br 3.5090000000 0.0000000000 0.0000000000 
Rb 0.0000000000 0.0000000000 7.0180000000 
Br 0.0000000000 3.5090000000 7.0180000000 
Rb 0.0000000000 3.5090000000 10.5270000000 
Br 0.0000000000 0.0000000000 10.5270000000 
Rb 3.5090000000 0.0000000000 10.5270000000 
Br 3.5090000000 3.5090000000 10.5270000000 
Rb 3.5090000000 3.5090000000 7.0180000000 
Br 3.5090000000 0.0000000000 7.0180000000 
Rb 0.0000000000 7.0180000000 0.0000000000 
Br 0.0000000000 10.5270000000 0.0000000000 
Rb 0.0000000000 10.5270000000 3.5090000000 
Br 0.0000000000 7.0180000000 3.5090000000 
Rb 3.5090000000 7.0180000000 3.5090000000 
Br 3.5090000000 10.5270000000 3.5090000000 
Rb 3.5090000000 10.5270000000 0.0000000000 
Br 3.5090000000 7.0180000000 0.0000000000 
Rb 0.0000000000 7.0180000000 7.0180000000 
Br 0.0000000000 10.5270000000 7.0180000000 
Rb 0.0000000000 10.5270000000 10.5270000000 
Br 0.0000000000 7.0180000000 10.5270000000 
Rb 3.5090000000 7.0180000000 10.5270000000 
Br 3.5090000000 10.5270000000 10.5270000000 
Rb 3.5090000000 10.5270000000 7.0180000000 
Br 3.5090000000 7.0180000000 7.0180000000 
Rb 7.0180000000 0.0000000000 0.0000000000 
Br 7.0180000000 3.5090000000 0.0000000000 
Rb 7.0180000000 3.5090000000 3.5090000000 
Br 7.0180000000 0.0000000000 3.5090000000 
Rb 10.5270000000 0.0000000000 3.5090000000 
Br 10.5270000000 3.5090000000 3.5090000000 
Rb 10.5270000000 3.5090000000 0.0000000000 
Br 10.5270000000 0.0000000000 0.0000000000 
Rb 7.0180000000 0.0000000000 7.0180000000 
Br 7.0180000000 3.5090000000 7.0180000000 
Rb 7.0180000000 3.5090000000 10.5270000000 
Br 7.0180000000 0.0000000000 10.5270000000 
Rb 10.5270000000 0.0000000000 10.5270000000 
Br 10.5270000000 3.5090000000 10.5270000000 
Rb 10.5270000000 3.5090000000 7.0180000000 
Br 10.5270000000 0.0000000000 7.0180000000 
Rb 7.0180000000 7.0180000000 0.0000000000 
Br 7.0180000000 10.5270000000 0.0000000000 
Rb 7.0180000000 10.5270000000 3.5090000000 
Br 7.0180000000 7.0180000000 3.5090000000 
Rb 10.5270000000 7.0180000000 3.5090000000 
Br 10.5270000000 10.5270000000 3.5090000000 
Rb 10.5270000000 10.5270000000 0.0000000000 
Br 10.5270000000 7.0180000000 0.0000000000 
Rb 7.0180000000 7.0180000000 7.0180000000 
Br 7.0180000000 10.5270000000 7.0180000000 
Rb 7.0180000000 10.5270000000 10.5270000000 
Br 7.0180000000 7.0180000000 10.5270000000 
Rb 10.5270000000 7.0180000000 10.5270000000 
Br 10.5270000000 10.5270000000 10.5270000000 
Rb 10.5270000000 10.5270000000 7.0180000000 
Br 10.5270000000 7.0180000000 7.0180000000 

EOF

python /work/app/ALAMODE/current/tools/displace.py --QE=pw.scf_${condition_name}.in --mag=${mag} ${prefix}.pattern_HARMONIC > displace.log
disps=($(ls disp*.pw.in))

for disp in ${disps[@]};
do
echo ${disp:0:-2}'out'
pw.x < ${disp} > ${disp:0:-2}'out' 2> ${disp:0:-2}'err'
done

aprun python /work/app/ALAMODE/current/tools/extract.py --QE=pw.scf_${condition_name}.in *.pw.out > DFSET_harmonic_${condition_name}


rm -r ./RbBr/

done

done

done

done

# --------------------------------calculation--------------------------------------------